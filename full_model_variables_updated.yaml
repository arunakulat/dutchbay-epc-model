# full_model_variables_updated.yaml  (repo root)
# Master inputs for Dutch Bay wind appraisal — all policy/assumptions live here.

project:
  name: Dutch Bay Wind Project
  capacity_mw: 150            # variable: 90..150 by scenarios
  capacity_factor: 0.40       # or use availability_pct/loss_factor instead
  degradation: 0.006          # per-year energy degradation (fraction, 0..1)

  timeline:
    # nominal operating life (exclude construction); adapter uses this length to build series
    lifetime_years: 20

tariff:
  # The PPA is in LKR, unindexed. Use this key; adapters convert via FX per year.
  lkr_per_kwh: 20.30

fx:
  # Either give explicit curve, OR start + annual depreciation
  start_lkr_per_usd: 300
  annual_depr: 0.03
  # curve_lkr_per_usd: []  # optional explicit list if you want to override start+depr

capex:
  # Provide either total or per-MW; no floors here (enforced by validation/scenarios).
  usd_total: 150000000        # example: 225 MUSD total
  # usd_per_mw: 1500000       # alternative shape

opex:
  # You may combine fixed and per-MWh, and combine USD + LKR legs; adapter sums them.
  usd_per_year: 3000000       # example: 6 MUSD/y total
  # lkr_per_year: 0
  # usd_per_mwh: 0
  # lkr_per_mwh: 0


tax:
  corporate_tax_rate: 0.30   # 30% of earnings before tax (standard SL/India)
  depreciation_years: 15     # straight-line for tax shield
  min_tax: 0                 # min tax floor

regulatory:
  success_fee_pct: 0.01      # 1% of revenue paid as success/licensing fee
  env_surcharge_pct: 0.005   # 0.5% of revenue for environment/CSR
  social_services_levy_pct: 0.025   # 2.5% of revenue for social levy

risk_adjustment:
  cfads_haircut_pct: 0.10    # 10% reduction to CFADS for technical/market risk (P90 min)

Financing_Terms:
  # Debt sizing and style
  debt_ratio: 0.70
  tenor_years: 15
  interest_only_years: 2
  amortization_style: target_dscr      # auto | target_dscr | annuity | straight_line

  # Rate input style – pick ONE: interest_rate_nominal OR (base_rate + margin_bps)
  interest_rate_nominal: 0.08   # decimal (8%)

  # Tranche mix caps (total debt composition)
  mix:
    lkr_max: 0.45               # ≤ 45% of total debt in LKR
    dfi_max: 0.10               # ≤ 10% of total debt from DFI
    usd_commercial_min: 0.45    # optional floor for USD commercial

  # Tranche rate floors (decimal)
  rates:
    lkr_min: 0.08               # ≥ 8% for LKR leg
    usd_commercial_min: 0.075   # ≥ 7.5% for USD commercial
    dfi_min: 0.065              # ≥ 6.5% for DFI

  # DSCR sculpting & covenant
  target_dscr: 1.30
  min_dscr: 1.20
  dscr_probability_basis: P50   # or P90; optional dscr_haircut_factor instead
  # dscr_haircut_factor: 0.90

  # Reserves / receivables guarantee
  reserves:
    dsra_months: 6              # 0 if you rely on receivables guarantee
    receivables_guarantee_months: 9
  use_revenue_guarantee: false
  guarantee_revenue_pct: 0.0075 # 0.75% of annual revenue as fee proxy
  guarantee_max_months: 9

  # Fees (optional)
  fees:
    upfront_pct: 0.01
    commitment_pct: 0.01

  # Hard covenant enforcement
  enforce_hard_covenants: false # set true to raise on dscr_min<min_dscr or balloon>0 at maturity

  Financing_Terms:
  # ... (keep all existing fields like debt_ratio, tenor_years, etc.)
  
   # ============================================================================
  # INSTITUTIONAL CONSTRAINTS & VALIDATION (Enhanced - P0-1B Final)
  # ============================================================================
  # These constraints enforce global banking standards and are used by the
  # validation engine in finance/debt.py. 
  #
  # ALIGNMENT NOTE:
  # - Code default max_debt_ratio: 0.85 (fallback for missing YAML)
  # - YAML setting: 0.80 (more conservative, DFI standard)
  # - YAML value takes precedence when present
  # - This allows scenario-specific tuning while maintaining safety defaults
  # ============================================================================
  
  constraints:
    # --------------------------------------------------------------------------
    # LEVERAGE LIMITS
    # --------------------------------------------------------------------------
    max_debt_ratio: 0.80           # Hard cap on debt/CAPEX (DFI standard)
                                   # Code fallback: 0.85 if not specified
                                   # Rationale: DFI lenders typically require ≤80%
                                   # For commercial banks, can raise to 0.85
                                   # For ECA, can go up to 0.85-0.90
    
    warn_debt_ratio: 0.75          # Warning threshold (before max)
                                   # Triggers logging but allows execution
    
    # --------------------------------------------------------------------------
    # DSCR COVENANTS (Debt Service Coverage Ratio)
    # --------------------------------------------------------------------------
    min_dscr_covenant: 1.30        # Hard floor - lender covenant requirement
                                   # IFC/World Bank standard: 1.30-1.35
                                   # Commercial banks: 1.25-1.30
                                   # Below this triggers ERROR
    
    target_dscr: 1.35              # Design target for sculpted debt
                                   # Model will aim for this in all years
    
    warn_dscr: 1.25                # Early warning threshold
                                   # Triggers WARNING but allows execution
    
    # --------------------------------------------------------------------------
    # BALLOON PAYMENT LIMITS & REFINANCING
    # --------------------------------------------------------------------------
    max_balloon_pct: 0.10          # Max balloon as % of original principal
                                   # Standard: 5-10% for project finance
                                   # Above this triggers ERROR
    
    warn_balloon_pct: 0.05         # Warning threshold for balloon
                                   # Triggers WARNING if balloon > 5%
                                   # 5-10% range requires refinancing plan
    
    # Refinancing assumptions (for balloon > warn threshold)
    refinancing:
      enabled: true                # Set false to reject any balloon
      max_refinance_pct: 0.10      # Max 15% of principal can be refinanced
      refinance_rate_premium: 0.02 # +2% rate premium for refinancing
      refinance_tenor_years: 3     # Refinancing period (typically 3-5 years)
      
      # Documentation requirements when balloon > 5%
      requires_documentation: true
      documentation_notes: |
        Balloon payment between 5-10% requires:
        - Refinancing commitment letter from lender
        - OR cash sweep mechanism to reduce balloon
        - OR equity injection commitment at maturity
        - Documented in financing term sheet
    
    # --------------------------------------------------------------------------
    # TENOR LIMITS
    # --------------------------------------------------------------------------
    max_tenor_years: 20            # Hard cap on loan term (adjusted from 25)
                                   # Rationale: Wind/solar typical max is 18-20 years
                                   # Hydro can go 25-30 years
                                   # Shorter tenor reduces balloon risk
    
    warn_tenor_years: 18           # Warning threshold for tenor
                                   # Triggers WARNING if tenor > 18 years
    
    # --------------------------------------------------------------------------
    # INTEREST RATE VALIDATION
    # --------------------------------------------------------------------------
    max_interest_rate: 0.25        # 25% max - prevents data entry errors
                                   # Any rate above this triggers ERROR
    
    min_interest_rate: 0.0         # Must be non-negative
                                   # Negative rates trigger ERROR
    
    # --------------------------------------------------------------------------
    # LENDER CLASSIFICATION (for logging/audit)
    # --------------------------------------------------------------------------
    lender_type: "DFI"             # Options: "DFI", "Commercial", "ECA"
                                   # DFI: Most conservative (current settings)
                                   # Commercial: Can relax to 0.85 debt, 1.25 DSCR
                                   # ECA: Can go to 0.85-0.90 debt, 1.20 DSCR
    
    jurisdiction: "Sri Lanka"      # Project jurisdiction
                                   # Documents regulatory environment
    
    # --------------------------------------------------------------------------
    # AUDIT BEHAVIOR FLAGS
    # --------------------------------------------------------------------------
    fail_on_covenant_breach: false # Set to true to raise error (not just warn)
                                   # when DSCR < min_dscr_covenant
                                   # Use for final validation before lender submission
    
    fail_on_large_balloon: false   # Set to true to raise error (not just warn)
                                   # when balloon > max_balloon_pct
                                   # Use for strict DFI requirements
    
    # --------------------------------------------------------------------------
    # PARAMETER ALIGNMENT DOCUMENTATION
    # --------------------------------------------------------------------------
    # This section documents the relationship between YAML and code defaults:
    #
    # Parameter              | YAML Value | Code Fallback | Effective Value
    # -----------------------|------------|---------------|----------------
    # max_debt_ratio         | 0.80       | 0.85          | 0.80 (YAML wins)
    # min_dscr_covenant      | 1.30       | 1.30          | 1.30 (aligned)
    # max_balloon_pct        | 0.10       | 0.10          | 0.10 (aligned)
    # max_tenor_years        | 20         | 25            | 20 (YAML wins)
    #
    # YAML values always take precedence when present.
    # Code fallbacks ensure model doesn't fail if constraints section is missing.
    # --------------------------------------------------------------------------
    
    # --------------------------------------------------------------------------
    # VALIDATION NOTES (for audit trail)
    # --------------------------------------------------------------------------
    # These constraints match:
    # - IFC Performance Standards (PS2 - Labor and Working Conditions)
    # - World Bank Environmental and Social Framework
    # - Asian Development Bank Safeguard Policy Statement
    # - Sri Lanka Securities and Exchange Commission guidelines
    # 
    # Last reviewed: 2025-11-12
    # Approved by: [Investment Committee / CFO / Project Finance Team]
    # Next review: Before financial close or material changes
    # --------------------------------------------------------------------------
